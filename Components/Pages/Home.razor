@page "/"
@rendermode InteractiveServer
@inject BlazorWebApp.Services.FileService FileService
@inject IWebHostEnvironment Env

<PageTitle>Home</PageTitle>

<h3 class="mb-4">Monitoring App</h3>

<!-- ===== Feature Cards ===== -->
<div class="container mb-4">
    <div class="row g-4">

        <!-- Dashboard -->
        <div class="col-md-4">
            <div class="card shadow-sm home-card text-center">
                <div class="card-body">
                    <div class="home-icon bg-primary text-white mb-3">
                        <i class="bi bi-bar-chart-line"></i>
                    </div>
                    <h5 class="card-title">Dashboard</h5>
                    <p class="card-text">View login trend charts for all customers, with support for filtering and chart downloading.</p>
                    <NavLink href="dashboard" class="btn btn-primary w-100">Enter Dashboard</NavLink>
                </div>
            </div>
        </div>

        <!-- Files List -->
        <div class="col-md-4">
            <div class="card shadow-sm home-card text-center">
                <div class="card-body">
                    <div class="home-icon bg-success text-white mb-3">
                        <i class="bi bi-folder2-open"></i>
                    </div>
                    <h5 class="card-title">Files List</h5>
                    <p class="card-text">View all uploaded customer login statistics XML files and convert them to Excel files for download.</p>
                    <NavLink href="files" class="btn btn-success w-100">View Files List</NavLink>
                </div>
            </div>
        </div>

        <!-- Upload -->
        <div class="col-md-4">
            <div class="card shadow-sm home-card text-center">
                <div class="card-body">
                    <div class="home-icon bg-warning text-white mb-3">
                        <i class="bi bi-cloud-upload-fill"></i>
                    </div>
                    <h5 class="card-title">Upload XML</h5>
                    <p class="card-text">Upload the new customer login statistics XML file and update the system automatically.</p>
                    <NavLink href="upload" class="btn btn-warning text-white w-100">Upload File</NavLink>
                </div>
            </div>
        </div>

        <!-- API Docs -->
        <div class="col-md-4">
            <div class="card shadow-sm home-card text-center">
                <div class="card-body">
                    <div class="home-icon bg-info text-white mb-3">
                        <i class="bi bi-code"></i>
                    </div>
                    <h5 class="card-title">API Documentation</h5>
                    <p class="card-text">View the API documentation and examples for automatic customer login statistics file upload.</p>
                    <NavLink href="api-docs" class="btn btn-info w-100">View API documentation</NavLink>
                </div>
            </div>
        </div>

        <!-- System Info -->
        <div class="col-md-4">
            <div class="card shadow-sm home-card text-center">
                <div class="card-body">
                    <div class="home-icon bg-secondary text-white mb-3">
                        <i class="bi bi-gear-fill"></i>
                    </div>
                    <h5 class="card-title">System Overview</h5>
                    <p class="card-text">View system function overview, functional description and technical features.</p>
                    <NavLink href="system-info" class="btn btn-secondary w-100">View System Overview</NavLink>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ===== Recent Uploads ===== -->
<div class="container mb-4">
    <h5 class="mb-3">Recent Uploads</h5>

    @if (recentUploads.Count == 0)
    {
        <p class="text-muted">No uploaded customer login statistics XML files found.</p>
    }
    else
    {
        <ul class="list-group shadow-sm recent-list">
            @foreach (var item in recentUploads)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>@item.FileName</strong>
                        <div class="text-muted" style="font-size: 12px;">
                            Customer: @item.ClientName
                        </div>
                    </div>
                    <span class="badge bg-primary rounded-pill" style="font-size: 12px;">
                        @item.Timestamp.ToString("yyyy-MM-dd HH:mm")
                    </span>
                </li>
            }
        </ul>
    }
</div>

@code {
    private List<(string ClientName, string FileName, DateTime Timestamp)> recentUploads = new();

    protected override void OnInitialized()
    {
        var root = Path.Combine(Env.ContentRootPath, "Uploads");

        if (!Directory.Exists(root))
            return;

        var clientDirs = Directory.GetDirectories(root);
        var allFiles = clientDirs
            .SelectMany(dir =>
                Directory.GetFiles(dir, "*.xml")
                        .Select(f => (
                            ClientName: Path.GetFileName(dir),
                            FileName: Path.GetFileName(f),
                            Timestamp: System.IO.File.GetLastWriteTime(f)
                        ))
            )
            .OrderByDescending(f => f.Timestamp)
            .ToList();

        recentUploads = allFiles.Take(5).ToList();
    }
}

<style>
    /* Feature Cards */
    .home-card {
        border-radius: 12px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .home-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 18px rgba(0, 0, 0, 0.15);
    }
    .home-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        font-size: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    <!-- Recent Uploads -->
    .recent-list .list-group-item {
        border-left: 5px solid #0d6efd;
        transition: background-color 0.2s ease;
    }

    .recent-list .list-group-item:hover {
        background-color: #f6f9ff;
    }
</style>
